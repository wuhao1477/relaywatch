#!/bin/sh /etc/rc.common

# relaywatchd 的 procd 服务脚本，负责守护进程的启动、重载与日志输出。

START=95
USE_PROCD=1
PROG=/usr/sbin/relaywatchd

start_service() {
        # 以前台模式交由 procd 管理并启用自动重启
        procd_open_instance
        procd_set_param command "$PROG" -f
        procd_set_param respawn 300 5 5
        procd_set_param stdout 1
        procd_set_param stderr 1
        procd_close_instance
}

stop_service() {
        # procd 接管进程，停止时无需额外动作
        :
}

reload_service() {
        # 发送 USR1 信号触发守护进程立即重新加载配置
        procd_send_signal relaywatchd
}

service_triggers() {
        # 当 relaywatch 配置或无线配置变化时自动触发重载
        procd_add_reload_trigger relaywatch wireless
}
